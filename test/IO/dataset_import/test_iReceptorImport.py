import os
import shutil
from unittest import TestCase
from zipfile import ZipFile

import pandas as pd

from immuneML.IO.dataset_import.IReceptorImport import IReceptorImport
from immuneML.data_model.dataset.RepertoireDataset import RepertoireDataset
from immuneML.data_model.dataset.SequenceDataset import SequenceDataset
from immuneML.dsl.DefaultParamsLoader import DefaultParamsLoader
from immuneML.environment.Constants import Constants
from immuneML.environment.EnvironmentSettings import EnvironmentSettings
from immuneML.util.PathBuilder import PathBuilder


class TestIReceptorImport(TestCase):

    def create_dummy_dataset(self, path, zip_name, disease_name):
        airr_tsv_content = f"""sequence_id	sequence	sequence_aa	rev_comp	productive	vj_in_frame	stop_codon	complete_vdj	locus	v_call	d_call	d2_call	j_call	c_call	sequence_alignment	sequence_alignment_aa	germline_alignment	germline_alignment_aa	junction	junction_aa	np1	np1_aa	np2	np2_aa	np3	np3_aa	cdr1	cdr1_aa	cdr2	cdr2_aa	cdr3	cdr3_aa	fwr1	fwr1_aa	fwr2	fwr2_aa	fwr3	fwr3_aa	fwr4	fwr4_aa	v_score	v_identity	v_support	v_cigar	d_score	d_identity	d_support	d_cigar	d2_score	d2_identity	d2_support	d2_cigar	j_score	j_identity	j_support	j_cigar	c_score	c_identity	c_support	c_cigar	v_sequence_start	v_sequence_end	v_germline_start	v_germline_end	v_alignment_start	v_alignment_end	d_sequence_start	d_sequence_end	d_germline_start	d_germline_end	d_alignment_start	d_alignment_end	d2_sequence_start	d2_sequence_end	d2_germline_start	d2_germline_end	d2_alignment_start	d2_alignment_end	j_sequence_start	j_sequence_end	j_germline_start	j_germline_end	j_alignment_start	j_alignment_end	cdr1_start	cdr1_end	cdr2_start	cdr2_end	cdr3_start	cdr3_end	fwr1_start	fwr1_end	fwr2_start	fwr2_end	fwr3_start	fwr3_end	fwr4_start	fwr4_end	v_sequence_alignment	v_sequence_alignment_aa	d_sequence_alignment	d_sequence_alignment_aa	d2_sequence_alignment	d2_sequence_alignment_aa	j_sequence_alignment	j_sequence_alignment_aa	c_sequence_alignment	c_sequence_alignment_aa	v_germline_alignment	v_germline_alignment_aa	d_germline_alignment	d_germline_alignment_aa	d2_germline_alignment	d2_germline_alignment_aa	j_germline_alignment	j_germline_alignment_aa	c_germline_alignment	c_germline_alignment_aa	junction_length	junction_aa_length	np1_length	np2_length	np3_length	n1_length	n2_length	n3_length	p3v_length	p5d_length	p3d_length	p5d2_length	p3d2_length	p5j_length	consensus_count	duplicate_count	cell_id	clone_id	rearrangement_id	repertoire_id	sample_processing_id	data_processing_id	germline_database	rearrangement_set_id
5faf13b34929cde020a981db	AGCTGTGGGCTCAGAAGCAGAGTTCTGGGGTGTCTCCACCATGGCCTGGACCCCTCTCTGGCTCACTCTCTTCACTCTTTGCATAGGTTCTGTGGTTTCTTCTGAGCTGACTCAGGACCCTGCTGTGTCTGTGGCCTTGGGACAGACAGTCAGGATCACATGCCAAGGAGACAGCCTCAGAAGCTATTATGCAAGCTGGTACCAGCAGAAGCCAGGACAGGCCCCTGTACTTGTCATCTATGGTAAAAACAACCGGCCCTCAGGGATCCCAGACCGATTCTCTGGCTCCAGCTCAGGAAACACAGCTTCCTTGACCATCACTGGGGCTCAGGCGGAAGATGAGGCTGACTATTACTGTAACTCCCGGGACAGCAGTGGTAACCATGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWTPLWLTLFTLCIGSVVSSELTQDPAVSVALGQTVRITCQGDSLRSYYASWYQQKPGQAPVLVIYGKNNRPSGIPDRFSGSSSGNTASLTITGAQAEDEADYYCNSRDSSGNHVVFGGGTKLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV3-19			IGLJ2	IGLC3	AGCTGTGGGCTCAGAAGCAGAGTTCTGGGGTGTCTCCACCATGGCCTGGACCCCTCTCTGGCTCACTCTCTTCACTCTTTGCATAGGTTCTGTGGTTTCTTCTGAGCTGACTCAGGACCCTGCTGTGTCTGTGGCCTTGGGACAGACAGTCAGGATCACATGCCAAGGAGACAGCCTCAGAAGCTATTATGCAAGCTGGTACCAGCAGAAGCCAGGACAGGCCCCTGTACTTGTCATCTATGGTAAAAACAACCGGCCCTCAGGGATCCCAGACCGATTCTCTGGCTCCAGCTCAGGAAACACAGCTTCCTTGACCATCACTGGGGCTCAGGCGGAAGATGAGGCTGACTATTACTGTAACTCCCGGGACAGCAGTGGTAACCATGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		AGCTGTGGGCTCAGAAGCAGAGTTCTGGGGTGTCTCCACCATGGCCTGGACCCCTCTCTGGCTCACTCTCCTCACTCTTTGCATAGGTTCTGTGGTTTCTTCTGAGCTGACTCAGGACCCTGCTGTGTCTGTGGCCTTGGGACAGACAGTCAGGATCACATGCCAAGGAGACAGCCTCAGAAGCTATTATGCAAGCTGGTACCAGCAGAAGCCAGGACAGGCCCCTGTACTTGTCATCTATGGTAAAAACAACCGGCCCTCAGGGATCCCAGACCGATTCTCTGGCTCCAGCTCAGGAAACACAGCTTCCTTGACCATCACTGGGGCTCAGGCGGAAGATGAGGCTGACTATTACTGTAACTCCCGGGACAGCAGTGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTAACTCCCGGGACAGCAGTGGTAACCATGTGGTATTC	CNSRDSSGNHVVF																								40S337M256S												384S38M211S				422S211M	41	377																	385	422																																							39	13													8974	12	AAACGGGAGACTCGGA-1			{zip_name}_rep1	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981dc	CTTCTCTGGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGATGTCAGTAAGCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTTTCGTCTTCGGAACTGGGACCAAGGTCACCGTCCTAGGTCAGCCCAAGGCCAACCCCACTGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTCCAAGCCAACAAGGCCACACTAGTGTGTCTGATCAGTGACTTCTACCCGGGAGCTGTGACAGTGGCCTGGAAGGCAGATGGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCAAACCCTCCAAACAGAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWALLLLTLLTQGTGSWAQSALTQPASVSGSPGQSITISCTGTSSDVGGYNYVSWYQQHPGKAPKLMIYDVSKRPSGVSNRFSGSKSGNTASLTISGLQAEDEADYYCSSYTSSSTFVFGTGTKVTVLGQPKANPTVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADGSPVKAGVETTKPSKQSNNKYAASS	F	T				IGL	IGLV2-14			IGLJ1	IGLC1	CTTCTCTGGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGATGTCAGTAAGCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTTTCGTCTTCGGAACTGGGACCAAGGTCACCGTCCTAGGTCAGCCCAAGGCCAACCCCACTGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTCCAAGCCAACAAGGCCACACTAGTGTGTCTGATCAGTGACTTCTACCCGGGAGCTGTGACAGTGGCCTGGAAGGCAGATGGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCAAACCCTCCAAACAGAGCAACAACAAGTACGCGGCCAGCAGCTA		ATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGAGGTCAGTAATCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTCTCCACAGTGTTATGTCTTCGGAACTGGGACCAAGGTCACCGTCCTAGGTCAGCCCAAGGCCAACCCCACTGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTCCAAGCCAACAAGGCCACACTAGTGTGTCTGATCAGTGACTTCTACCCGGGAGCTGTGACAGTGGCCTGGAAGGCAGATGGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCAAACCCTCCAAACAGAGCAACAACAAGTACGCGGCCAGCAGCTA		TGCAGCTCATATACAAGCAGCAGCACTTTCGTCTTC	CSSYTSSSTFVF																								49S351M248S												399S38M211S				437S211M	50	400																	400	437																																							36	12													10786	14	AACGTTGGTGCTGTAT-1			{zip_name}_rep1	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981dd	AGCTTCAGCTGTGGGTAGAGGAGACAGGACTCAGGACAATCTCCAGCATGGCCAGCTTCCCTCTCCTCCTCACCCTCCTCACTCACTGTGCAGGGTCCTGGGCCCAGTCTGTGCTGACTCAGCCTCCCTCAGCGTCTGGGCCCCCCGGGCAGAGGGTCTCCATCTTTTGTTCTGGAAGCAGCTCCAACGTCGGAAGTAATTCTGTAAGCTGGTACCAGTACCTCCCAGGAGCGGCCCCCAAACTCCTCATCTATGGTAAAAATCAGCGGCCCTCAGGGGTCCCTGACCGATTTTCTGGCTCCCAGTCTGGCACCTCAGCCTCCCTGGCCATCAGTGGGCTCCGGTCTGATGATGAGGCTGAATATTACTGTGCTGCATGGGATGACAGCCTGAACTGTCCGATCTTTGGCGGAGGGACCACCCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MASFPLLLTLLTHCAGSWAQSVLTQPPSASGPPGQRVSIFCSGSSSNVGSNSVSWYQYLPGAAPKLLIYGKNQRPSGVPDRFSGSQSGTSASLAISGLRSDDEAEYYCAAWDDSLNCPIFGGGTTLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV1-44			IGLJ2	IGLC3	AGCTTCAGCTGTGGGTAGAGGAGACAGGACTCAGGACAATCTCCAGCATGGCCAGCTTCCCTCTCCTCCTCACCCTCCTCACTCACTGTGCAGGGTCCTGGGCCCAGTCTGTGCTGACTCAGCCTCCCTCAGCGTCTGGGCCCCCCGGGCAGAGGGTCTCCATCTTTTGTTCTGGAAGCAGCTCCAACGTCGGAAGTAATTCTGTAAGCTGGTACCAGTACCTCCCAGGAGCGGCCCCCAAACTCCTCATCTATGGTAAAAATCAGCGGCCCTCAGGGGTCCCTGACCGATTTTCTGGCTCCCAGTCTGGCACCTCAGCCTCCCTGGCCATCAGTGGGCTCCGGTCTGATGATGAGGCTGAATATTACTGTGCTGCATGGGATGACAGCCTGAACTGTCCGATCTTTGGCGGAGGGACCACCCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		CTGATTTGCATGGATGGACTCTCCCCCTCTCAGAGTATGAAGAGAGGGAGAGATCTGGGGGAAGCTCAGCTTCAGCTGTGGGTAGAGAAGACAGGACTCAGGACAATCTCCAGCATGGCCAGCTTCCCTCTCCTCCTCACCCTCCTCACTCACTGTGCAGGGTCCTGGGCCCAGTCTGTGCTGACTCAGCCACCCTCAGCGTCTGGGACCCCCGGGCAGAGGGTCACCATCTCTTGTTCTGGAAGCAGCTCCAACATCGGAAGTAATACTGTAAACTGGTACCAGCAGCTCCCAGGAACGGCCCCCAAACTCCTCATCTATAGTAATAATCAGCGGCCCTCAGGGGTCCCTGACCGATTCTCTGGCTCCAAGTCTGGCACCTCAGCCTCCCTGGCCATCAGTGGGCTCCAGTCTGAGGATGAGGCTGATTATTACTGTGCAGCATGGGATGACAGCCTGAATGGTCCTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTGCTGCATGGGATGACAGCCTGAACTGTCCGATCTTT	CAAWDDSLNCPIF																								47S353M246S												397S38M211S				435S211M	48	400																	398	435																																							39	13													3472	7	AACTCCCCATCAGTAC-1			{zip_name}_rep1	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981de	AGCTGTGGGCTCAGAAGCAGAGTTCTGGGGTGTCTCCACCATGGCCTGGACCCCTCTCTGGCTCACTCTCTTCACTCTTTGCATAGGTTCTGTGGTTTCTTCTGAGGTGACTCAGGACCCTGCTGTGTCTGTGGCCTTGGGACAGACAGTCAGGATCACATGCCAAGGAGACAGCCTCAGAAGCTTTTATGCAAGCTGGTACCAGCAGAAGCCAGGACAGGCCCCTGTTATTGTCATCTATGGTAAAAATAATCGGCCCTCAGGGATCCCAGACCGATTCTCTGGCTCCAGGTCAGGAAACACAGCTTCCTTGACCATCAGTGGGGCTCAGGCGGACGATGAGGCTGACTATTACTGTAACTCCCGGGACAGCAGTGGTAACCATGTGGTATTCGGCGGAGGGACCAAGTTGACCGTCCTGCGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWTPLWLTLFTLCIGSVVSSEVTQDPAVSVALGQTVRITCQGDSLRSFYASWYQQKPGQAPVIVIYGKNNRPSGIPDRFSGSRSGNTASLTISGAQADDEADYYCNSRDSSGNHVVFGGGTKLTVLRQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV3-19			IGLJ2	IGLC2	AGCTGTGGGCTCAGAAGCAGAGTTCTGGGGTGTCTCCACCATGGCCTGGACCCCTCTCTGGCTCACTCTCTTCACTCTTTGCATAGGTTCTGTGGTTTCTTCTGAGGTGACTCAGGACCCTGCTGTGTCTGTGGCCTTGGGACAGACAGTCAGGATCACATGCCAAGGAGACAGCCTCAGAAGCTTTTATGCAAGCTGGTACCAGCAGAAGCCAGGACAGGCCCCTGTTATTGTCATCTATGGTAAAAATAATCGGCCCTCAGGGATCCCAGACCGATTCTCTGGCTCCAGGTCAGGAAACACAGCTTCCTTGACCATCAGTGGGGCTCAGGCGGACGATGAGGCTGACTATTACTGTAACTCCCGGGACAGCAGTGGTAACCATGTGGTATTCGGCGGAGGGACCAAGTTGACCGTCCTGCGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		AGCTGTGGGCTCAGAAGCAGAGTTCTGGGGTGTCTCCACCATGGCCTGGACCCCTCTCTGGCTCACTCTCCTCACTCTTTGCATAGGTTCTGTGGTTTCTTCTGAGCTGACTCAGGACCCTGCTGTGTCTGTGGCCTTGGGACAGACAGTCAGGATCACATGCCAAGGAGACAGCCTCAGAAGCTATTATGCAAGCTGGTACCAGCAGAAGCCAGGACAGGCCCCTGTACTTGTCATCTATGGTAAAAACAACCGGCCCTCAGGGATCCCAGACCGATTCTCTGGCTCCAGCTCAGGAAACACAGCTTCCTTGACCATCACTGGGGCTCAGGCGGAAGATGAGGCTGACTATTACTGTAACTCCCGGGACAGCAGTGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTAACTCCCGGGACAGCAGTGGTAACCATGTGGTATTC	CNSRDSSGNHVVF																								40S337M256S												384S38M211S				422S211M	41	377																	385	422																																							39	13													22204	34	AAGCCGCCAGACGCCT-1			{zip_name}_rep1	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981df	AGATGGGGGCTGGGGTCTCATGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGCGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGATCCACCACTGACGTGGGAAATTATGACGATGTCTCCTGGTATCAACATTACGCAGGCGCAGCCCCCAAACTCATAATTTATAATGTCGATAAGCGGCCCTCCGGGATTTCTGATCGCTTCTCTGGCTCCAGGTCTGGCAGCACGGCCTCCCTGACCATCTCTAAGCTCGAGACTGCCGACGAGTCTATTTTCTATTGTAGTTCATATTCAACTGCCAGCGCTTCTGTGGTCTTCGGCGGAGGGACCAAGTTGGCCGTCCTCAGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWALLLLTLLTQGTGSWAQSALTQPASVSASPGQSITISCTGSTTDVGNYDDVSWYQHYAGAAPKLIIYNVDKRPSGISDRFSGSRSGSTASLTISKLETADESIFYCSSYSTASASVVFGGGTKLAVLSQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV2-14			IGLJ2	IGLC3	AGATGGGGGCTGGGGTCTCATGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGCGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGATCCACCACTGACGTGGGAAATTATGACGATGTCTCCTGGTATCAACATTACGCAGGCGCAGCCCCCAAACTCATAATTTATAATGTCGATAAGCGGCCCTCCGGGATTTCTGATCGCTTCTCTGGCTCCAGGTCTGGCAGCACGGCCTCCCTGACCATCTCTAAGCTCGAGACTGCCGACGAGTCTATTTTCTATTGTAGTTCATATTCAACTGCCAGCGCTTCTGTGGTCTTCGGCGGAGGGACCAAGTTGGCCGTCCTCAGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		ATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGAGGTCAGTAATCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTCTCCACAGTGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTAGTTCATATTCAACTGCCAGCGCTTCTGTGGTCTTC	CSSYSTASASVVF																								49S291M311S												402S38M211S				440S211M	50	340																	403	440																																							39	13													59668	112	ACAGCTAGTAAGTGGC-1			{zip_name}_rep1	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e0	TGGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGATGTCAGTAAGCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTTTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWALLLLTLLTQGTGSWAQSALTQPASVSGSPGQSITISCTGTSSDVGGYNYVSWYQQHPGKAPKLMIYDVSKRPSGVSNRFSGSKSGNTASLTISGLQAEDEADYYCSSYTSSSTLVFGGGTKLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV2-14			IGLJ2	IGLC2	TGGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGATGTCAGTAAGCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTTTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		ATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGAGGTCAGTAATCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTCTCCACAGTGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGCAGCTCATATACAAGCAGCAGCACTTTGGTATTC	CSSYTSSSTLVF																								43S351M248S												393S38M211S				431S211M	44	394																	394	431																																							36	12													15278	24	ACATACGCAGATGAGC-1			{zip_name}_rep2	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e1	TGGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCGGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGCAGCCACCGGTGACATTAATGATTATAACGATGTCTCCTGGTACCAGCTTCAGCCAGGCGAGGCCCCCAAACTCATAATTTATGCTGTCAATAAACGACCCTCAGCGGTTTCTCGTCGCATCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATAGCGTCACCAGCTCTTCTGTGATTTCCGTGGTGTTCGGCGGAGGGACCAAGCTGACCGTCCTAAGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWALLLLTLLTQGTGSWARSALTQPASVSGSPGQSITISCTAATGDINDYNDVSWYQLQPGEAPKLIIYAVNKRPSAVSRRISGSKSGNTASLTISGLQAEDEADYYCSSYSVTSSSVISVVFGGGTKLTVLSQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV2-14			IGLJ2	IGLC3	TGGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCGGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGCAGCCACCGGTGACATTAATGATTATAACGATGTCTCCTGGTACCAGCTTCAGCCAGGCGAGGCCCCCAAACTCATAATTTATGCTGTCAATAAACGACCCTCAGCGGTTTCTCGTCGCATCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATAGCGTCACCAGCTCTTCTGTGATTTCCGTGGTGTTCGGCGGAGGGACCAAGCTGACCGTCCTAAGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		ATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGAGGTCAGTAATCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTCTCCACAGTGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGCAGCTCATATAGCGTCACCAGCTCTTCTGTGATTTCCGTGGTGTTC	CSSYSVTSSSVISVVF																								43S337M274S												405S38M211S				443S211M	44	380																	406	443																																							48	16													964	5	ACCAGTACAGTAGAGC-1			{zip_name}_rep2	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e2	TGAGCGCAGAAGGCAGGACTCGGGACAATCTTCATCATGACCTGCTCCCCTCTCCTCCTCACCCTTCTCATTCACTGCACAGGGTCCTGGGCCCAGTCTGTGTTGACGCAGCCGCCCTCAGTGTCTGCGGCCCCAGGACAGAAGGTCACCATCTCCTGCTCTGGAAGCAGCTCCAACATTGGGAATAATTATGTATCCTGGTACCAGCAGCTCCCAGGAACAGCCCCCAAACTCCTCATTTATGACAATAATAAGCGACCCTCAGGGATTCCTGACCGATTCTCTGGCTCCAAGTCTGGCACGTCAGCCACCCTGGGCATCACCGGACTCCAGACTGGGGACGAGGCCGATTATTACTGCGGAACATGGGATAGCAGCCTGAGTGCTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MTCSPLLLTLLIHCTGSWAQSVLTQPPSVSAAPGQKVTISCSGSSSNIGNNYVSWYQQLPGTAPKLLIYDNNKRPSGIPDRFSGSKSGTSATLGITGLQTGDEADYYCGTWDSSLSAVVFGGGTKLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV1-51			IGLJ2	IGLC2	TGAGCGCAGAAGGCAGGACTCGGGACAATCTTCATCATGACCTGCTCCCCTCTCCTCCTCACCCTTCTCATTCACTGCACAGGGTCCTGGGCCCAGTCTGTGTTGACGCAGCCGCCCTCAGTGTCTGCGGCCCCAGGACAGAAGGTCACCATCTCCTGCTCTGGAAGCAGCTCCAACATTGGGAATAATTATGTATCCTGGTACCAGCAGCTCCCAGGAACAGCCCCCAAACTCCTCATTTATGACAATAATAAGCGACCCTCAGGGATTCCTGACCGATTCTCTGGCTCCAAGTCTGGCACGTCAGCCACCCTGGGCATCACCGGACTCCAGACTGGGGACGAGGCCGATTATTACTGCGGAACATGGGATAGCAGCCTGAGTGCTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGAGCGCAGAAGGCAGGACTCGGGACAATCTTCATCATGACCTGCTCCCCTCTCCTCCTCACCCTTCTCATTCACTGCACAGGGTCCTGGGCCCAGTCTGTGTTGACGCAGCCGCCCTCAGTGTCTGCGGCCCCAGGACAGAAGGTCACCATCTCCTGCTCTGGAAGCAGCTCCAACATTGGGAATAATTATGTATCCTGGTACCAGCAGCTCCCAGGAACAGCCCCCAAACTCCTCATTTATGACAATAATAAGCGACCCTCAGGGATTCCTGACCGATTCTCTGGCTCCAAGTCTGGCACGTCAGCCACCCTGGGCATCACCGGACTCCAGACTGGGGACGAGGCCGATTATTACTGCGGAACATGGGATAGCAGCCTGAGTGCTGGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGCGGAACATGGGATAGCAGCCTGAGTGCTGTGGTATTC	CGTWDSSLSAVVF																								36S353M246S												386S38M211S				424S211M	37	389																	387	424																																							39	13													3862	9	ACGAGGAGTAAGTGGC-1			{zip_name}_rep2	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e3	GCTCTGCTTCAGCTGTGGGCACAAGAGGCAGCACTCAGGACAATCTCCAGCATGGCCTGGTCTCCTCTCCTCCTCACTCTCCTCGCTCACTGCACAGGGTCCTGGGCCCAGTCTGTGCTGACGCAGCCGCCCTCAGTGTCTGGGGCCCCAGGGCAGAGGGTCACCATCTCCTGCACTGGGAGCAGCTCCAACATCGGGGCAGGTTATGATGTACACTGGTACCAGCAGCTTCCAGGAACAGCCCCCAAACTCCTCATCTATGGTAACAGCAATCGGCCCTCAGGGGTCCCTGACCGATTCTCTGGCTCCAAGTCTGGCACCTCAGCCTCCCTGGCCATCACTGGGCTCCAGGCTGAGGATGAGGCTGATTATTACTGCCAGTCCTATGACAGCAGCCTGAGTGGTTATGTCTTCGGAACTGGGACCAAGGTCACCGTCCTAGGTCAGCCCAAGGCCAACCCCACTGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTCCAAGCCAACAAGGCCACACTAGTGTGTCTGATCAGTGACTTCTACCCGGGAGCTGTGACAGTGGCCTGGAAGGCAGATGGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCAAACCCTCCAAACAGAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWSPLLLTLLAHCTGSWAQSVLTQPPSVSGAPGQRVTISCTGSSSNIGAGYDVHWYQQLPGTAPKLLIYGNSNRPSGVPDRFSGSKSGTSASLAITGLQAEDEADYYCQSYDSSLSGYVFGTGTKVTVLGQPKANPTVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADGSPVKAGVETTKPSKQSNNKYAASS	F	T				IGL	IGLV1-40			IGLJ1	IGLC1	GCTCTGCTTCAGCTGTGGGCACAAGAGGCAGCACTCAGGACAATCTCCAGCATGGCCTGGTCTCCTCTCCTCCTCACTCTCCTCGCTCACTGCACAGGGTCCTGGGCCCAGTCTGTGCTGACGCAGCCGCCCTCAGTGTCTGGGGCCCCAGGGCAGAGGGTCACCATCTCCTGCACTGGGAGCAGCTCCAACATCGGGGCAGGTTATGATGTACACTGGTACCAGCAGCTTCCAGGAACAGCCCCCAAACTCCTCATCTATGGTAACAGCAATCGGCCCTCAGGGGTCCCTGACCGATTCTCTGGCTCCAAGTCTGGCACCTCAGCCTCCCTGGCCATCACTGGGCTCCAGGCTGAGGATGAGGCTGATTATTACTGCCAGTCCTATGACAGCAGCCTGAGTGGTTATGTCTTCGGAACTGGGACCAAGGTCACCGTCCTAGGTCAGCCCAAGGCCAACCCCACTGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTCCAAGCCAACAAGGCCACACTAGTGTGTCTGATCAGTGACTTCTACCCGGGAGCTGTGACAGTGGCCTGGAAGGCAGATGGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCAAACCCTCCAAACAGAGCAACAACAAGTACGCGGCCAGCAGCTA		GCTCTGCTTCAGCTGTGGGCACAAGAGGCAGCACTCAGGACAATCTCCAGCATGGCCTGGTCTCCTCTCCTCCTCACTCTCCTCGCTCACTGCACAGGGTCCTGGGCCCAGTCTGTGCTGACGCAGCCGCCCTCAGTGTCTGGGGCCCCAGGGCAGAGGGTCACCATCTCCTGCACTGGGAGCAGCTCCAACATCGGGGCAGGTTATGATGTACACTGGTACCAGCAGCTTCCAGGAACAGCCCCCAAACTCCTCATCTATGGTAACAGCAATCGGCCCTCAGGGGTCCCTGACCGATTCTCTGGCTCCAAGTCTGGCACCTCAGCCTCCCTGGCCATCACTGGGCTCCAGGCTGAGGATGAGGCTGATTATTACTGCCAGTCCTATGACAGCAGCCTGAGTGGTTCTTATGTCTTCGGAACTGGGACCAAGGTCACCGTCCTAGGTCAGCCCAAGGCCAACCCCACTGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTCCAAGCCAACAAGGCCACACTAGTGTGTCTGATCAGTGACTTCTACCCGGGAGCTGTGACAGTGGCCTGGAAGGCAGATGGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCAAACCCTCCAAACAGAGCAACAACAAGTACGCGGCCAGCAGCTA		TGCCAGTCCTATGACAGCAGCCTGAGTGGTTATGTCTTC	CQSYDSSLSGYVF																								51S356M246S												404S38M211S				442S211M	52	407																	405	442																																							39	13													13446	17	ACGTCAAAGGGCTTGA-1			{zip_name}_rep2	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e4	GGGGTCTCAGGAGGCAGCGCTCTCAGGACGTCACCACCATGGCCTGGGCTCTGCTCCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTCCCTCCGCGTCCGGGTCTCCTGGACAGTCAGTCACCATCTCCTGCACTGGAACCAGCAGTGACATTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCGAAGCCCCCAAACTCATGATTTATGAGGTCAATAAGCGGCCCTCAGGGGTCCCTGATCGCTTCTCTGGCTCCAGGTCTGGCAACACGGCCTCCCTGACCGTCTCTGGGCTCCAGGCTGAGGATGAGGCTGATTATTACTGTGCCTCAGTTGCAGGCGGTGACAACTTGCTATTCGGCGGAGGGACCAAACTGACCGTCTTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWALLLLTLLTQGTGSWAQSALTQPPSASGSPGQSVTISCTGTSSDIGGYNYVSWYQQHPGEAPKLMIYEVNKRPSGVPDRFSGSRSGNTASLTVSGLQAEDEADYYCASVAGGDNLLFGGGTKLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV2-8			IGLJ2	IGLC2	GGGGTCTCAGGAGGCAGCGCTCTCAGGACGTCACCACCATGGCCTGGGCTCTGCTCCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTCCCTCCGCGTCCGGGTCTCCTGGACAGTCAGTCACCATCTCCTGCACTGGAACCAGCAGTGACATTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCGAAGCCCCCAAACTCATGATTTATGAGGTCAATAAGCGGCCCTCAGGGGTCCCTGATCGCTTCTCTGGCTCCAGGTCTGGCAACACGGCCTCCCTGACCGTCTCTGGGCTCCAGGCTGAGGATGAGGCTGATTATTACTGTGCCTCAGTTGCAGGCGGTGACAACTTGCTATTCGGCGGAGGGACCAAACTGACCGTCTTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TCTCTAAGCCCAGGCCCAAGTGAGGGTGGGGTGAGAAGAGGAGCTCAGGATGCAGATTTGCATGGAGGTCCCGCCCTTCTCTGAGGCAGAGGGGATAAGACAGGGCTGGGGGCAGGCCCAGTGCTGGGGTCTCAGGAGGCAGCGCTCTCAGGACGTCACCACCATGGCCTGGGCTCTGCTCCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTCCCTCCGCGTCCGGGTCTCCTGGACAGTCAGTCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGAGGTCAGTAAGCGGCCCTCAGGGGTCCCTGATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCGTCTCTGGGCTCCAGGCTGAGGATGAGGCTGATTATTACTGCAGCTCATATGCAGGCAGCAACAATTTCTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTGCCTCAGTTGCAGGCGGTGACAACTTGCTATTC	CASVAGGDNLLF																								38S326M273S												388S38M211S				426S211M	39	364																	389	426																																							36	12													58494	808	AGAGCTTTCCCAGGTG-1			{zip_name}_rep2	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e5	AGCCTGGGCCTCAGGAAGCAGCATCGGGGGTGCCGCAGCCATGGCCTGGACCGCTCTCCTTCTGAGCCTCCTTGCTCACTTTACAGGTTCTGTGGCCTCCTATGAGCTGACTCAGCCACTCTCAGTGTCAGTGGCCCTGGGACAGACGGCCAGGATTACCTGTGGGGGAAACAACATTGGAAGTAAAAATGTGCACTGGTACCAGCAGAAGCCAGGCCAGGCCCCTGTGCTGGTCATCTATAGGGATAGCAACCGGCCCTCTGGGATCCCTGAGCGATTCTCTGGCTCCAACTCGGGGAACACGGCCACCCTGACCATCAGCAGAGCCCAAGCCGGGGATGAGGCTGACTATTACTGTCAGGTGTGGGACAGCAGCACTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWTALLLSLLAHFTGSVASYELTQPLSVSVALGQTARITCGGNNIGSKNVHWYQQKPGQAPVLVIYRDSNRPSGIPERFSGSNSGNTATLTISRAQAGDEADYYCQVWDSSTVVFGGGTKLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV3-9			IGLJ2	IGLC2	AGCCTGGGCCTCAGGAAGCAGCATCGGGGGTGCCGCAGCCATGGCCTGGACCGCTCTCCTTCTGAGCCTCCTTGCTCACTTTACAGGTTCTGTGGCCTCCTATGAGCTGACTCAGCCACTCTCAGTGTCAGTGGCCCTGGGACAGACGGCCAGGATTACCTGTGGGGGAAACAACATTGGAAGTAAAAATGTGCACTGGTACCAGCAGAAGCCAGGCCAGGCCCCTGTGCTGGTCATCTATAGGGATAGCAACCGGCCCTCTGGGATCCCTGAGCGATTCTCTGGCTCCAACTCGGGGAACACGGCCACCCTGACCATCAGCAGAGCCCAAGCCGGGGATGAGGCTGACTATTACTGTCAGGTGTGGGACAGCAGCACTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		CTTGACTCTGCTGATTTGCATCACAGGCTGCTCTCTTCAGCAAGGGGATAAGAGAGGGCTGGAAGGAACCTGCCCAGCCTGGGCCTCAGGAAGCAGCATCGGGGGTGCCGCAGCCATGGCCTGGACCGCTCTCCTTCTGAGCCTCCTTGCTCACTTTACAGGTTCTGTGGCCTCCTATGAGCTGACTCAGCCACTCTCAGTGTCAGTGGCCCTGGGACAGACGGCCAGGATTACCTGTGGGGGAAACAACATTGGAAGTAAAAATGTGCACTGGTACCAGCAGAAGCCAGGCCAGGCCCCTGTGCTGGTCATCTATAGGGATAGCAACCGGCCCTCTGGGATCCCTGAGCGATTCTCTGGCTCCAACTCGGGGAACACGGCCACCCTGACCATCAGCAGAGCCCAAGCCGGGGATGAGGCTGACTATTACTGTCAGGTGTGGGACAGCAGCACTGCACACATGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTCAGGTGTGGGACAGCAGCACTGTGGTATTC	CQVWDSSTVVF																								40S340M247S												378S38M211S				416S211M	41	380																	379	416																																							33	11													1416	4	AGCGTCGGTCAGGACA-1			{zip_name}_rep2	samp1	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e6	AGCCTGGGCCTCAGGAAGCAGCATCGGGGGTGCCGCAGCCATGGCCTGGACCGCTCTCCTTCTGAGCCTCCTTGCTCACTTTACAGGTTCTGTGGGCGCCTATGAACTGGCTCAGCCACGCTCCGTGTCAGTGGCCCTGGGACAGACGGCCACTATTACCTGTGGGCGAGACAACATTGGAAGTGAAAATGTGCACTGGTACCAACTCAGGCCAGGCCAGGCCCCTGTCCTGGTCATCTATAGGGATAACAACCGGCCCTCTGGGATCCCTGAGCGATTCTCTGGCTCCAACTCGGGGAACACGGCCACCCTGACCATCGACACCGCCCAAGCCGGCGATGAGGCTGACTATTTCTGTCAGGTGTGGGACAGCGTCTCCTTGGTTTTCGGCGGCGGGACCACGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWTALLLSLLAHFTGSVGAYELAQPRSVSVALGQTATITCGRDNIGSENVHWYQLRPGQAPVLVIYRDNNRPSGIPERFSGSNSGNTATLTIDTAQAGDEADYFCQVWDSVSLVFGGGTTLTVLGQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADSSPVKAGVETTTPSKQSNNKYAASS	F	T				IGL	IGLV3-9			IGLJ2	IGLC2	AGCCTGGGCCTCAGGAAGCAGCATCGGGGGTGCCGCAGCCATGGCCTGGACCGCTCTCCTTCTGAGCCTCCTTGCTCACTTTACAGGTTCTGTGGGCGCCTATGAACTGGCTCAGCCACGCTCCGTGTCAGTGGCCCTGGGACAGACGGCCACTATTACCTGTGGGCGAGACAACATTGGAAGTGAAAATGTGCACTGGTACCAACTCAGGCCAGGCCAGGCCCCTGTCCTGGTCATCTATAGGGATAACAACCGGCCCTCTGGGATCCCTGAGCGATTCTCTGGCTCCAACTCGGGGAACACGGCCACCCTGACCATCGACACCGCCCAAGCCGGCGATGAGGCTGACTATTTCTGTCAGGTGTGGGACAGCGTCTCCTTGGTTTTCGGCGGCGGGACCACGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		CTTGACTCTGCTGATTTGCATCACAGGCTGCTCTCTTCAGCAAGGGGATAAGAGAGGGCTGGAAGGAACCTGCCCAGCCTGGGCCTCAGGAAGCAGCATCGGGGGTGCCGCAGCCATGGCCTGGACCGCTCTCCTTCTGAGCCTCCTTGCTCACTTTACAGGTTCTGTGGCCTCCTATGAGCTGACTCAGCCACTCTCAGTGTCAGTGGCCCTGGGACAGACGGCCAGGATTACCTGTGGGGGAAACAACATTGGAAGTAAAAATGTGCACTGGTACCAGCAGAAGCCAGGCCAGGCCCCTGTGCTGGTCATCTATAGGGATAGCAACCGGCCCTCTGGGATCCCTGAGCGATTCTCTGGCTCCAACTCGGGGAACACGGCCACCCTGACCATCAGCAGAGCCCAAGCCGGGGATGAGGCTGACTATTACTGTCAGGTGTGGGACAGCAGCACTGCACACATGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCGCCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGTCAGGTGTGGGACAGCGTCTCCTTGGTTTTC	CQVWDSVSLVF																								40S333M254S												378S38M211S				416S211M	41	373																	379	416																																							33	11													8812	14	AGCTCCTTCCGCAAGC-1			{zip_name}_rep2	samp2	5faf101103b9977a150a9eaa		
5faf13b34929cde020a981e7	GGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCTTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCAGGTCAGTCGATCACCATCTCCTGCACTGGAGCCAGCAGTGACCCTATTAACTTTAACTCTGTCTCCTGGTACCAACAACACCCAGGGACAGCCCCCAAGGTCGTCATTTTTGGTGTCAGTAAGCGGCCCTCAGGGGTTTCTGATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCGGACTGAGGACGAGGCTGATTATTATTGCAGCTCATACACAGCCTCCAACACTTTCCTTTTCGGCGGTGGGACCAAGCTGACCGTCCTAAGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATTGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCGCACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA	MAWALLLLTLLTQGTGSWAQSALTQPASVSGSPGQSITISCTGASSDPINFNSVSWYQQHPGTAPKVVIFGVSKRPSGVSDRFSGSKSGNTASLTISGLRTEDEADYYCSSYTASNTFLFGGGTKLTVLSQPKAAPSVTLFPPSSEELQANKATLVCLISDFYPGAVTVAWKADCSPVKAGVETTAPSKQSNNKYAASS	F	T				IGL	IGLV2-14			IGLJ2	IGLC3	GGGGGGGGTCTCAGGAGGCAGCGCTCTCGGGACGTCTCCACCATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCTTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCAGGTCAGTCGATCACCATCTCCTGCACTGGAGCCAGCAGTGACCCTATTAACTTTAACTCTGTCTCCTGGTACCAACAACACCCAGGGACAGCCCCCAAGGTCGTCATTTTTGGTGTCAGTAAGCGGCCCTCAGGGGTTTCTGATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCGGACTGAGGACGAGGCTGATTATTATTGCAGCTCATACACAGCCTCCAACACTTTCCTTTTCGGCGGTGGGACCAAGCTGACCGTCCTAAGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATTGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCGCACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		ATGGCCTGGGCTCTGCTGCTCCTCACCCTCCTCACTCAGGGCACAGGGTCCTGGGCCCAGTCTGCCCTGACTCAGCCTGCCTCCGTGTCTGGGTCTCCTGGACAGTCGATCACCATCTCCTGCACTGGAACCAGCAGTGACGTTGGTGGTTATAACTATGTCTCCTGGTACCAACAGCACCCAGGCAAAGCCCCCAAACTCATGATTTATGAGGTCAGTAATCGGCCCTCAGGGGTTTCTAATCGCTTCTCTGGCTCCAAGTCTGGCAACACGGCCTCCCTGACCATCTCTGGGCTCCAGGCTGAGGACGAGGCTGATTATTACTGCAGCTCATATACAAGCAGCAGCACTCTCCACAGTGTGTGGTATTCGGCGGAGGGACCAAGCTGACCGTCCTAGGTCAGCCCAAGGCTGCCCCCTCGGTCACTCTGTTCCCACCCTCCTCTGAGGAGCTTCAAGCCAACAAGGCCACACTGGTGTGTCTCATAAGTGACTTCTACCCGGGAGCCGTGACAGTGGCCTGGAAGGCAGATAGCAGCCCCGTCAAGGCGGGAGTGGAGACCACCACACCCTCCAAACAAAGCAACAACAAGTACGCGGCCAGCAGCTA		TGCAGCTCATACACAGCCTCCAACACTTTCCTTTTC	CSSYTASNTFLF																								42S335M264S												392S38M211S				430S211M	43	377																	393	430																																							36	12													20364	40	AGCTCTCAGGCAGGTT-1			{zip_name}_rep2	samp2	5faf101103b9977a150a9eaa		"""

        metadata_json_content = '''{
    "Info": {
        "Title": "AIRR Data Commons API",
        "description": "API response for repertoire query",
        "version": 1.3,
        "contact": {
            "name": "AIRR Community",
            "url": "https:\/\/github.com\/airr-community"
        }
    },
    "Repertoire": [
        {
            "repertoire_id": "''' + zip_name + '''_rep1",
            "repertoire_name": null,
            "repertoire_description": null,
            "study": {
                "study_id": "PRJCA002413",
                "study_title": "Immune cell profiling of COVID-19 patients in the recovery stage by single-cell sequencing",
                "study_type": {
                    "label": "Case-Control Study",
                    "id": "NCIT:C15197"
                },
                "study_description": "An inflammatory immune signature in the early recovery stage of COVID-19 suggests patients are still vulnerable after hospital discharge.",
                "inclusion_exclusion_criteria": "Include: COVID",
                "grants": "National Natural Science Foundation of China, award number 81722034, 81670015, 81830054, 81530028, 91953122, 31871326, 81721003, 81988101; Ministry of Science and Technology Key Program, award number 2018ZX09101002, 2017ZX100203205; Shanghai Pujiang Program, award number 2019PJD059; Guangdong Natural Science Funds for Distinguished Young Scholar, award number 2016A030306006, 2020B1515020057",
                "collected_by": "xiaochuanle@126.com, cw0226@foxmail.com, hywangk@vip.sina.com",
                "lab_name": "National Center for Liver Cancer",
                "lab_address": "Second Military Medical University, 200438 Shanghai, China",
                "submitted_by": "Chuanle Xiao, xiaochuanle@126.com",
                "pub_ids": "PMID:\u00a032377375",
                "keywords_study": [
                    "contains_ig",
                    "contains_paired_chain"
                ]
            },
            "subject": {
                "subject_id": "person1",
                "synthetic": false,
                "species": {
                    "label": "Homo sapiens",
                    "id": "NCBITAXON:9606"
                },
                "organism": {
                    "label": null,
                    "id": null
                },
                "sex": "male",
                "age": null,
                "age_min": 30,
                "age_max": 80,
                "age_unit": {
                    "label": "year",
                    "id": "UO:0000036"
                },
                "age_event": "Sample Collection",
                "ancestry_population": null,
                "ethnicity": null,
                "race": null,
                "strain_name": null,
                "linked_subjects": null,
                "link_type": null,
                "diagnosis": [
                    {
                        "study_group_description": "Case",
                        "disease_diagnosis": {
                            "label": "COVID-19",
                            "id": "DOID:0080600"
                        },
                        "disease_length": null,
                        "disease_stage": "COVID_late_recovery",
                        "prior_therapies": "Oseltamivir, Methylprednisolone",
                        "immunogen": null,
                        "intervention": null,
                        "medical_history": "hypertension, coronary heart disease"
                    }
                ]
            },
            "sample": [
                {
                    "sample_processing_id": "samp1",
                    "sample_id": "samp1",
                    "sample_type": "peripheral venous puncture",
                    "tissue": {
                        "label": "peripheral blood",
                        "id": "UBERON:0013756"
                    },
                    "anatomic_site": null,
                    "disease_state_sample": null,
                    "collection_time_point_relative": "More than 14 days",
                    "collection_time_point_reference": "First negative COVID-19 test",
                    "biomaterial_provider": "Wuhan Hankou Hospital China",
                    "tissue_processing": "PBMCs isolated from heparinized venous blood using Ficoll-Hypaque density solution; cell viability exceeded 80%",
                    "cell_subset": {
                        "label": null,
                        "id": null
                    },
                    "cell_phenotype": null,
                    "cell_species": {
                        "label": "Homo sapiens",
                        "id": "NCBITAXON:9606"
                    },
                    "single_cell": true,
                    "cell_number": 343,
                    "cells_per_reaction": 1,
                    "cell_storage": false,
                    "cell_quality": "Viability exceeded 80%",
                    "cell_isolation": null,
                    "cell_processing_protocol": null,
                    "template_class": "RNA",
                    "template_quality": null,
                    "template_amount": null,
                    "library_generation_method": "RT(oligo-dT)+TS(UMI)+PCR",
                    "library_generation_protocol": "Single-cell suspensions of samples were converted to barcoded scRNA-seq libraries using the Chromium Single Cell 5\u2032 Library and Gel Bead Kit v2 (PN-120237), Multiplex Kit, and Chip Kit (10x Genomics). Full-length TCR\/BCR V(D)J segments were enriched from amplified cDNA from 5\u2032 libraries via PCR amplification using a Chromium Single-Cell V(D)J Enrichment kit (10x Genomics) according to the manufacturer\u2019s protocol.",
                    "library_generation_kit_version": null,
                    "pcr_target": [
                        {
                            "pcr_target_locus": "IGL",
                            "forward_pcr_primer_target_location": null,
                            "reverse_pcr_primer_target_location": "IGLC, +205; IGLC, +211"
                        }
                    ],
                    "complete_sequences": "complete+untemplated",
                    "physical_linkage": "none",
                    "sequencing_run_id": null,
                    "total_reads_passing_qc_filter": null,
                    "sequencing_platform": "Illumina NovaSeq 6000",
                    "sequencing_facility": null,
                    "sequencing_run_date": null,
                    "sequencing_kit": null,
                    "sequencing_files": {
                        "file_type": "fastq",
                        "filename": "CRR126627_f1.fastq.gz, CRR126628_f1.fastq.gz, CRR126629_f1.fastq.gz, CRR126630_f1.fastq.gz",
                        "read_direction": null,
                        "read_length": 150,
                        "paired_filename": "CRR126627_r2.fastq.gz, CRR126628_r2.fastq.gz, CRR126629_r2.fastq.gz, CRR126630_r2.fastq.gz",
                        "paired_read_direction": null,
                        "paired_read_length": 150
                    }
                }
            ],
            "data_processing": [
                {
                    "data_processing_id": "5faf101103b9977a150a9eaa",
                    "primary_annotation": true,
                    "software_versions": "Cell Ranger vdj pipeline (v.4.0.0)",
                    "paired_reads_assembly": null,
                    "quality_thresholds": null,
                    "primer_match_cutoffs": null,
                    "collapsing_method": null,
                    "data_processing_protocols": "Processing by iReceptor: BCR sequences for each single B cell were assembled by Cell Ranger vdj pipeline (v.4.0.0) with command: cellranger vdj --localcores=1 --localmem=7 --id=$SUBJECT-$CELL-$SLURM_JOB_ID --reference=$CELLRANGER\/10x-genome-refdata\/refdata-cellranger-vdj-GRCh38-alts-ensembl-4.0.0 --fastqs=$PROJ_DIR\/$SUBJECT\/$CELL. IGL annotations were obtained with command: for subject in *; do cd $subject\/b-cell; head -n 1  airr_rearrangement.tsv > $subject-IGL.tsv; egrep 'IGL[VDJ][0-9]'  airr_rearrangement.tsv >> $subject-IGL.tsv; done",
                    "data_processing_files": [
                        "LRS1-IGL.tsv"
                    ],
                    "germline_database": "refdata-cellranger-vdj-GRCh38-alts-ensembl-4.0.0",
                    "analysis_provenance_id": null
                }
            ]
        },
                {
            "repertoire_id": "''' + zip_name + '''_rep2",
            "repertoire_name": null,
            "repertoire_description": null,
            "study": {
                "study_id": "PRJCA002413",
                "study_title": "Immune cell profiling of COVID-19 patients in the recovery stage by single-cell sequencing",
                "study_type": {
                    "label": "Case-Control Study",
                    "id": "NCIT:C15197"
                },
                "study_description": "An inflammatory immune signature in the early recovery stage of COVID-19 suggests patients are still vulnerable after hospital discharge.",
                "inclusion_exclusion_criteria": "Include: COVID",
                "grants": "National Natural Science Foundation of China, award number 81722034, 81670015, 81830054, 81530028, 91953122, 31871326, 81721003, 81988101; Ministry of Science and Technology Key Program, award number 2018ZX09101002, 2017ZX100203205; Shanghai Pujiang Program, award number 2019PJD059; Guangdong Natural Science Funds for Distinguished Young Scholar, award number 2016A030306006, 2020B1515020057",
                "collected_by": "xiaochuanle@126.com, cw0226@foxmail.com, hywangk@vip.sina.com",
                "lab_name": "National Center for Liver Cancer",
                "lab_address": "Second Military Medical University, 200438 Shanghai, China",
                "submitted_by": "Chuanle Xiao, xiaochuanle@126.com",
                "pub_ids": "PMID:\u00a032377375",
                "keywords_study": [
                    "contains_ig",
                    "contains_paired_chain"
                ]
            },
            "subject": {
                "subject_id": "person2",
                "synthetic": false,
                "species": {
                    "label": "Homo sapiens",
                    "id": "NCBITAXON:9606"
                },
                "organism": {
                    "label": null,
                    "id": null
                },
                "sex": "male",
                "age": null,
                "age_min": 30,
                "age_max": 80,
                "age_unit": {
                    "label": "year",
                    "id": "UO:0000036"
                },
                "age_event": "Sample Collection",
                "ancestry_population": null,
                "ethnicity": null,
                "race": null,
                "strain_name": null,
                "linked_subjects": null,
                "link_type": null,
                "diagnosis": [
                    {
                        "study_group_description": "Control",
                        "disease_diagnosis": {
                            "label": "COVID-19",
                            "id": "DOID:0080600"
                        },
                        "disease_length": null,
                        "disease_stage": "COVID_late_recovery",
                        "prior_therapies": "Oseltamivir, Methylprednisolone",
                        "immunogen": null,
                        "intervention": null,
                        "medical_history": "hypertension, coronary heart disease"
                    },
                    {
                        "study_group_description": "Case",
                        "disease_diagnosis": {
                            "label": "''' + disease_name + '''",
                            "id": "DOID:000000"
                        },
                        "disease_length": null,
                        "disease_stage": null,
                        "prior_therapies": null,
                        "immunogen": null,
                        "intervention": null,
                        "medical_history": null
                    }
                ]
            },
            "sample": [
                {
                    "sample_processing_id": "samp1",
                    "sample_id": "samp1",
                    "sample_type": "peripheral venous puncture",
                    "tissue": {
                        "label": "peripheral blood",
                        "id": "UBERON:0013756"
                    },
                    "anatomic_site": null,
                    "disease_state_sample": null,
                    "collection_time_point_relative": "More than 14 days",
                    "collection_time_point_reference": "First negative COVID-19 test",
                    "biomaterial_provider": "Wuhan Hankou Hospital China",
                    "tissue_processing": "PBMCs isolated from heparinized venous blood using Ficoll-Hypaque density solution; cell viability exceeded 80%",
                    "cell_subset": {
                        "label": null,
                        "id": null
                    },
                    "cell_phenotype": null,
                    "cell_species": {
                        "label": "Homo sapiens",
                        "id": "NCBITAXON:9606"
                    },
                    "single_cell": true,
                    "cell_number": 343,
                    "cells_per_reaction": 1,
                    "cell_storage": false,
                    "cell_quality": "Viability exceeded 80%",
                    "cell_isolation": null,
                    "cell_processing_protocol": null,
                    "template_class": "RNA",
                    "template_quality": null,
                    "template_amount": null,
                    "library_generation_method": "RT(oligo-dT)+TS(UMI)+PCR",
                    "library_generation_protocol": "Single-cell suspensions of samples were converted to barcoded scRNA-seq libraries using the Chromium Single Cell 5\u2032 Library and Gel Bead Kit v2 (PN-120237), Multiplex Kit, and Chip Kit (10x Genomics). Full-length TCR\/BCR V(D)J segments were enriched from amplified cDNA from 5\u2032 libraries via PCR amplification using a Chromium Single-Cell V(D)J Enrichment kit (10x Genomics) according to the manufacturer\u2019s protocol.",
                    "library_generation_kit_version": null,
                    "pcr_target": [
                        {
                            "pcr_target_locus": "IGL",
                            "forward_pcr_primer_target_location": null,
                            "reverse_pcr_primer_target_location": "IGLC, +205; IGLC, +211"
                        }
                    ],
                    "complete_sequences": "complete+untemplated",
                    "physical_linkage": "none",
                    "sequencing_run_id": null,
                    "total_reads_passing_qc_filter": null,
                    "sequencing_platform": "Illumina NovaSeq 6000",
                    "sequencing_facility": null,
                    "sequencing_run_date": null,
                    "sequencing_kit": null,
                    "sequencing_files": {
                        "file_type": "fastq",
                        "filename": "CRR126627_f1.fastq.gz, CRR126628_f1.fastq.gz, CRR126629_f1.fastq.gz, CRR126630_f1.fastq.gz",
                        "read_direction": null,
                        "read_length": 150,
                        "paired_filename": "CRR126627_r2.fastq.gz, CRR126628_r2.fastq.gz, CRR126629_r2.fastq.gz, CRR126630_r2.fastq.gz",
                        "paired_read_direction": null,
                        "paired_read_length": 150
                    }
                },
                {
                    "sample_processing_id": "samp2",
                    "sample_id": "samp2",
                    "sample_type": "peripheral venous puncture",
                    "tissue": {
                        "label": "peripheral blood",
                        "id": "UBERON:0013756"
                    },
                    "anatomic_site": null,
                    "disease_state_sample": null,
                    "collection_time_point_relative": "More than 14 days",
                    "collection_time_point_reference": "First negative COVID-19 test",
                    "biomaterial_provider": "Wuhan Hankou Hospital China",
                    "tissue_processing": "PBMCs isolated from heparinized venous blood using Ficoll-Hypaque density solution; cell viability exceeded 80%",
                    "cell_subset": {
                        "label": null,
                        "id": null
                    },
                    "cell_phenotype": null,
                    "cell_species": {
                        "label": "Homo sapiens",
                        "id": "NCBITAXON:9606"
                    },
                    "single_cell": true,
                    "cell_number": 343,
                    "cells_per_reaction": 1,
                    "cell_storage": false,
                    "cell_quality": "Viability exceeded 80%",
                    "cell_isolation": null,
                    "cell_processing_protocol": null,
                    "template_class": "RNA",
                    "template_quality": null,
                    "template_amount": null,
                    "library_generation_method": "RT(oligo-dT)+TS(UMI)+PCR",
                    "library_generation_protocol": "Single-cell suspensions of samples were converted to barcoded scRNA-seq libraries using the Chromium Single Cell 5\u2032 Library and Gel Bead Kit v2 (PN-120237), Multiplex Kit, and Chip Kit (10x Genomics). Full-length TCR\/BCR V(D)J segments were enriched from amplified cDNA from 5\u2032 libraries via PCR amplification using a Chromium Single-Cell V(D)J Enrichment kit (10x Genomics) according to the manufacturer\u2019s protocol.",
                    "library_generation_kit_version": null,
                    "pcr_target": [
                        {
                            "pcr_target_locus": "IGL",
                            "forward_pcr_primer_target_location": null,
                            "reverse_pcr_primer_target_location": "IGLC, +205; IGLC, +211"
                        }
                    ],
                    "complete_sequences": "complete+untemplated",
                    "physical_linkage": "none",
                    "sequencing_run_id": null,
                    "total_reads_passing_qc_filter": null,
                    "sequencing_platform": "Illumina NovaSeq 6000",
                    "sequencing_facility": null,
                    "sequencing_run_date": null,
                    "sequencing_kit": null,
                    "sequencing_files": {
                        "file_type": "fastq",
                        "filename": "CRR126627_f1.fastq.gz, CRR126628_f1.fastq.gz, CRR126629_f1.fastq.gz, CRR126630_f1.fastq.gz",
                        "read_direction": null,
                        "read_length": 150,
                        "paired_filename": "CRR126627_r2.fastq.gz, CRR126628_r2.fastq.gz, CRR126629_r2.fastq.gz, CRR126630_r2.fastq.gz",
                        "paired_read_direction": null,
                        "paired_read_length": 150
                    }
                }
            ],
            "data_processing": [
                {
                    "data_processing_id": "5faf101103b9977a150a9eaa",
                    "primary_annotation": true,
                    "software_versions": "Cell Ranger vdj pipeline (v.4.0.0)",
                    "paired_reads_assembly": null,
                    "quality_thresholds": null,
                    "primer_match_cutoffs": null,
                    "collapsing_method": null,
                    "data_processing_protocols": "Processing by iReceptor: BCR sequences for each single B cell were assembled by Cell Ranger vdj pipeline (v.4.0.0) with command: cellranger vdj --localcores=1 --localmem=7 --id=$SUBJECT-$CELL-$SLURM_JOB_ID --reference=$CELLRANGER\/10x-genome-refdata\/refdata-cellranger-vdj-GRCh38-alts-ensembl-4.0.0 --fastqs=$PROJ_DIR\/$SUBJECT\/$CELL. IGL annotations were obtained with command: for subject in *; do cd $subject\/b-cell; head -n 1  airr_rearrangement.tsv > $subject-IGL.tsv; egrep 'IGL[VDJ][0-9]'  airr_rearrangement.tsv >> $subject-IGL.tsv; done",
                    "data_processing_files": [
                        "LRS1-IGL.tsv"
                    ],
                    "germline_database": "refdata-cellranger-vdj-GRCh38-alts-ensembl-4.0.0",
                    "analysis_provenance_id": null
                }
            ]
        }
    ]
}'''

        tsv_path = path / "airr.tsv"
        with tsv_path.open("w") as file:
            file.writelines(airr_tsv_content)

        metadata_path = path / "airr-metadata.json"
        with metadata_path.open("w") as file:
            file.writelines(metadata_json_content)

        info_path = path / "info.txt"
        with info_path.open("w") as file:
            file.writelines("some additional info file that should be ignored")

        zip_path = path / f"{zip_name}.zip"
        with ZipFile(zip_path, "w") as zipObj:
            zipObj.write(tsv_path, "airr.tsv")
            zipObj.write(metadata_path, "airr-metadata.json")
            zipObj.write(info_path, "info.txt")

        os.remove(tsv_path)
        os.remove(metadata_path)
        os.remove(info_path)

        return zip_path

    def test_import_repertoire_dataset(self):
        base_path = EnvironmentSettings.root_path / "test/tmp/ireceptorimport/"
        path = base_path / "repertoiredataset/"
        PathBuilder.build(path)
        ireceptor_zip1_path = self.create_dummy_dataset(path, zip_name="first_zip", disease_name="first_disease")
        ireceptor_zip2_path = self.create_dummy_dataset(path, zip_name="second_zip", disease_name="second_disease")

        params = DefaultParamsLoader.load(EnvironmentSettings.default_params_path / "datasets", "i_receptor")
        params["result_path"] = path / "result"
        params["path"] = path

        dataset = IReceptorImport.import_dataset(params, "ireceptor_repertoiredataset")

        self.assertEqual(6, dataset.get_example_count())
        self.assertEqual(RepertoireDataset, type(dataset))

        metadata_df = pd.read_csv(params["result_path"] / "ireceptor_repertoiredataset_metadata.csv", comment=Constants.COMMENT_SIGN)

        valid_metadata = '''
subject_id	repertoire_id	sample_processing_id	data_processing_id	study_id	species_label	sex	age_min	age_max	age_event	tissue_label	collection_time_point_relative	collection_time_point_reference	COVID-19	COVID-19_stage	second_disease	first_disease
person1	first_zip_rep1	samp1	5faf101103b9977a150a9eaa	PRJCA002413	Homo sapiens	male	30	80	Sample Collection	peripheral blood	More than 14 days	First negative COVID-19 test	Case	COVID_late_recovery		
person2	first_zip_rep2	samp1	5faf101103b9977a150a9eaa	PRJCA002413	Homo sapiens	male	30	80	Sample Collection	peripheral blood	More than 14 days	First negative COVID-19 test	Control	COVID_late_recovery		Case
person2	first_zip_rep2	samp2	5faf101103b9977a150a9eaa	PRJCA002413	Homo sapiens	male	30	80	Sample Collection	peripheral blood	More than 14 days	First negative COVID-19 test	Control	COVID_late_recovery		Case
person1	second_zip_rep1	samp1	5faf101103b9977a150a9eaa	PRJCA002413	Homo sapiens	male	30	80	Sample Collection	peripheral blood	More than 14 days	First negative COVID-19 test	Case	COVID_late_recovery		
person2	second_zip_rep2	samp1	5faf101103b9977a150a9eaa	PRJCA002413	Homo sapiens	male	30	80	Sample Collection	peripheral blood	More than 14 days	First negative COVID-19 test	Control	COVID_late_recovery	Case	
person2	second_zip_rep2	samp2	5faf101103b9977a150a9eaa	PRJCA002413	Homo sapiens	male	30	80	Sample Collection	peripheral blood	More than 14 days	First negative COVID-19 test	Control	COVID_late_recovery	Case	'''

        valid_metadata_path = path / "valid_metadata.tsv"
        with valid_metadata_path.open("w") as file:
            file.writelines(valid_metadata)

        valid_metadata_df = pd.read_csv(valid_metadata_path, sep="\t")

        metadata_df_subset = metadata_df.drop(["filename", "identifier"], axis=1)

        valid_metadata_df.sort_values("repertoire_id", axis=0, inplace=True)
        valid_metadata_df.sort_index(axis=1, inplace=True)
        metadata_df_subset.sort_values("repertoire_id", axis=0, inplace=True)
        metadata_df_subset.sort_index(axis=1, inplace=True)

        pd.testing.assert_frame_equal(valid_metadata_df.reset_index(drop=True), metadata_df_subset.reset_index(drop=True))

        shutil.rmtree(base_path)

    def test_import_sequence_dataset(self):
        base_path = EnvironmentSettings.root_path / "test/tmp/ireceptorimport/"
        path = base_path / "sequencedataset/"
        PathBuilder.build(path)
        ireceptor_zip1_path = self.create_dummy_dataset(path, zip_name="first_zip", disease_name="first_disease")
        ireceptor_zip2_path = self.create_dummy_dataset(path, zip_name="second_zip", disease_name="second_disease")

        params = DefaultParamsLoader.load(EnvironmentSettings.default_params_path / "datasets", "i_receptor")
        params["result_path"] = path / "result"
        params["path"] = path
        params["is_repertoire"] = False
        params["paired"] = False

        dataset = IReceptorImport.import_dataset(params, "ireceptor_sequencedataset")

        self.assertEqual(26, dataset.get_example_count())
        self.assertEqual(SequenceDataset, type(dataset))

        shutil.rmtree(base_path)

    def test_safe_get_field(self):
        dict = {"field1": {"field2": {"field3": "field4"}}}

        self.assertEqual(IReceptorImport._safe_get_field(dict, ["field1", "field2", "field3"]), "field4")
        self.assertEqual(IReceptorImport._safe_get_field(dict, ["field4"]), None)
        self.assertDictEqual(IReceptorImport._safe_get_field(dict, ["field1", "field2"]), {"field3": "field4"})
